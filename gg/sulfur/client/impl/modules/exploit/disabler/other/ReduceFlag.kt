package gg.sulfur.client.impl.modules.exploit.disabler.other

import gg.sulfur.client.impl.events.PacketEvent
import gg.sulfur.client.impl.modules.exploit.disabler.DisablerMode
import gg.sulfur.client.impl.utils.networking.PacketUtil
import net.minecraft.network.Packet
import net.minecraft.network.play.client.C03PacketPlayer
import net.minecraft.network.play.server.S08PacketPlayerPosLook
import kotlin.math.sqrt


/**
 * @author Kansio
 * @created 1:20 AM
 * @project Client
 */

class ReduceFlag : DisablerMode("Reduce Flags") {

    override fun onPacket(event: PacketEvent?) {
        val packet = event?.getPacket<Packet>()
        if (packet is S08PacketPlayerPosLook) {
            val x = packet.x - mc.thePlayer.posX
            val y = packet.y - mc.thePlayer.posY
            val z = packet.z - mc.thePlayer.posZ
            val diff = sqrt(x * x + y * y + z * z)
            if (diff <= 8) {
                event.forceCancel(true)
                PacketUtil.sendPacketNoEvent(
                    C03PacketPlayer.C06PacketPlayerPosLook(
                        packet.x,
                        packet.y,
                        packet.z,
                        packet.getYaw(),
                        packet.getPitch(),
                        true
                    )
                )
            }
        }
    }
}