package gg.sulfur.client.impl.modules.exploit

import gg.sulfur.client.api.module.Module
import com.google.common.eventbus.Subscribe
import gg.sulfur.client.api.module.ModuleData
import gg.sulfur.client.api.property.impl.BooleanValue
import gg.sulfur.client.api.property.impl.NumberValue
import gg.sulfur.client.api.property.impl.StringValue
import gg.sulfur.client.impl.events.BlockCollisionEvent
import gg.sulfur.client.impl.events.MovementEvent
import gg.sulfur.client.impl.events.PacketEvent
import gg.sulfur.client.impl.events.UpdateEvent
import gg.sulfur.client.impl.modules.exploit.disabler.DisablerMode
import gg.sulfur.client.impl.modules.movement.flight.FlightMode
import gg.sulfur.client.impl.modules.movement.speed.SpeedMode
import gg.sulfur.client.impl.utils.ReflectUtils


/**
 * @author Kansio
 * @created 1:00 AM
 * @project Client
 */

class Disabler(moduleData: ModuleData?) : Module(moduleData) {

    //Credit: FDPClient (the Reflection stuff)
    private val modes = ReflectUtils.getReflects("${this.javaClass.`package`.name}.disabler", DisablerMode::class.java).map { it.newInstance() as DisablerMode }.sortedBy { it.modeName }
    val mode: DisablerMode get() = modes.find { modeValue.equals(it.modeName) } ?: throw NullPointerException() // this should not happen


    private val modeValue = StringValue("Mode", this, *modes.map { it.modeName }.toTypedArray())
    val speed = NumberValue("Speed", this, 1.0, 0.0, 5.0);
    val multi = BooleanValue("Multi", this, false)

    init {
        register(modeValue, speed)
    }

    override fun onEnable() {
        if (!multi.value)
        mode.onEnable()
    }

    override fun onDisable() {
        if (!multi.value)
        mode.onDisable()


    }

    @Subscribe
    fun onUpdate(event: UpdateEvent) {
        if (!multi.value)
        mode.onUpdate(event)
    }

    @Subscribe
    fun onMove(event: MovementEvent) {
        if (!multi.value)
        mode.onMove(event)
    }

    @Subscribe
    fun onPacket(event: PacketEvent) {
        if (!multi.value)
        mode.onPacket(event)
    }

    @Subscribe
    fun onCollide(event: BlockCollisionEvent) {
        if (!multi.value)
        mode.onCollide(event)
    }

    override fun getSuffix(): String {
        return " ${mode.modeName}"
    }
}